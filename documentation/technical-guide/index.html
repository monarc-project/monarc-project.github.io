<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="description" content="Technical guide of MONARC">
<meta name="keywords" content="risk-analysis, monarc, technical-guide">
<meta name="author" content="NC3 Luxembourg">
<title>Technical Guide</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Technical Guide</h1>
<div class="details">
<span id="author" class="author">NC3 Luxembourg</span><br>
<span id="email" class="email"><a href="mailto:info@nc3.lu">info@nc3.lu</a></span><br>
<span id="revnumber">version 2023-01-31</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#purpose">1.1. Purpose</a></li>
<li><a href="#other-documents">1.2. Other documents</a></li>
</ul>
</li>
<li><a href="#requirements">2. Requirements</a>
<ul class="sectlevel2">
<li><a href="#system-and-software">2.1. System and software</a></li>
<li><a href="#specifications-by-server">2.2. Specifications by server</a></li>
<li><a href="#network">2.3. Network</a></li>
<li><a href="#tls-certificate">2.4. TLS certificate</a></li>
</ul>
</li>
<li><a href="#architecture">3. Architecture</a>
<ul class="sectlevel2">
<li><a href="#modules-of-the-project">3.1. Modules of the project</a></li>
<li><a href="#global-architecture">3.2. Global architecture</a></li>
<li><a href="#network-requirements">3.3. Network requirements</a></li>
</ul>
</li>
<li><a href="#installation-deployment">4. Installation / Deployment</a>
<ul class="sectlevel2">
<li><a href="#monarc-front-office-application">4.1. MONARC Front Office application</a>
<ul class="sectlevel3">
<li><a href="#prepared-virtual-machine">4.1.1. Prepared virtual machine</a></li>
<li><a href="#manual-deployment">4.1.2. Manual deployment</a></li>
</ul>
</li>
<li><a href="#monarc-back-office-application">4.2. MONARC Back Office application.</a>
<ul class="sectlevel3">
<li><a href="#requirements-2">4.2.1. Requirements</a></li>
<li><a href="#usage">4.2.2. Usage</a></li>
<li><a href="#configuration">4.2.3. Configuration</a></li>
<li><a href="#launch-ansible-periodically-with-cron">4.2.4. Launch ansible periodically with cron</a></li>
<li><a href="#update-the-ansible-playbook">4.2.5. Update the ansible playbook</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#updates">5. Updates</a>
<ul class="sectlevel2">
<li><a href="#system-update">5.1. System update</a></li>
<li><a href="#monarc-update">5.2. MONARC update</a>
<ul class="sectlevel3">
<li><a href="#update-a-single-monarc-instance">5.2.1. Update a single MONARC instance</a></li>
<li><a href="#update-monarc-when-connected-to-a-back-office">5.2.2. Update MONARC when connected to a back office</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#stats-service">6. Stats Service</a>
<ul class="sectlevel2">
<li><a href="#installation-of-the-stats-service">6.1. Installation of the Stats Service</a></li>
<li><a href="#accounts-on-the-stats-service">6.2. Accounts on the Stats Service</a></li>
<li><a href="#configuration-of-front-office-instance">6.3. Configuration of Front Office instance</a></li>
<li><a href="#configuration-of-the-cronjob">6.4. Configuration of the cronjob</a></li>
<li><a href="#recommendations">6.5. Recommendations</a></li>
<li><a href="#challenges">6.6. Challenges</a></li>
<li><a href="#global-dashboard-on-stats-service">6.7. Global Dashboard on Stats Service</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="purpose"><a class="anchor" href="#purpose"></a><a class="link" href="#purpose">1.1. Purpose</a></h3>
<div class="paragraph">
<p>This document is intended to administrators of a MONARC instance.
If you find errors or omissions in this document, please don&#8217;t hesitate to
submit an <a href="https://github.com/monarc-project/technical-guide/issues">issue</a>
or open a
<a href="https://github.com/monarc-project/technical-guide/pulls">pull request</a>
with a fix.</p>
</div>
</div>
<div class="sect2">
<h3 id="other-documents"><a class="anchor" href="#other-documents"></a><a class="link" href="#other-documents">1.2. Other documents</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.monarc.lu/documentation/quick-start"><strong>Quick Start</strong></a>: Provide a quick start with MONARC.</p>
</li>
<li>
<p><a href="https://www.monarc.lu/documentation/user-guide"><strong>User Guide</strong></a>: Complete documentation of the tool.</p>
</li>
<li>
<p><a href="https://www.monarc.lu/documentation/method-guide"><strong>Method Guide</strong></a>: Complete documentation of the method.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="#requirements"></a><a class="link" href="#requirements">2. Requirements</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-and-software"><a class="anchor" href="#system-and-software"></a><a class="link" href="#system-and-software">2.1. System and software</a></h3>
<div class="paragraph">
<p>The deployment of MONARC is mainly tested on Ubuntu 18.04 LTS.
In order to install MONARC you will need the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Git;</p>
</li>
<li>
<p>PHP (version 7.4):</p>
<div class="ulist">
<ul>
<li>
<p>PHP libraries are managed with <a href="https://getcomposer.org">composer</a>;</p>
</li>
</ul>
</div>
</li>
<li>
<p>JavaScript:</p>
<div class="ulist">
<ul>
<li>
<p>JavaScript libraries are managed with <a href="https://www.npmjs.com">npm</a>;</p>
</li>
</ul>
</div>
</li>
<li>
<p>Apache 2;</p>
</li>
<li>
<p>MariaDB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Postfix, or an equivalent software, is required for the account creation and
password recovery features.</p>
</div>
<div class="paragraph">
<p>You will find more details about the installation
<a href="https://github.com/monarc-project/MonarcAppFO/tree/master/INSTALL">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="specifications-by-server"><a class="anchor" href="#specifications-by-server"></a><a class="link" href="#specifications-by-server">2.2. Specifications by server</a></h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Minimum requirements</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Back office</th>
<th class="tableblock halign-center valign-top">MONARC</th>
<th class="tableblock halign-center valign-top">Reverse proxy</th>
<th class="tableblock halign-center valign-top">Configuration server</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Number of vCPU</p></th>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-left valign-top" rowspan="3"><div class="content"><div class="paragraph">
<p>Not that powerful.</p>
</div>
<div class="paragraph">
<p>But all connections (for the BO and FOs) will go through it.</p>
</div></div></td>
<td class="tableblock halign-left valign-top" rowspan="3"><div class="content"><div class="paragraph">
<p>Not that powerful.</p>
</div>
<div class="paragraph">
<p>Mainly used for the creation of clients on the different FOs.</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">RAM (GB)</p></th>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>4</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>16</p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">HDD (GB)</p></th>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>20</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p>50</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of course these values are minimum requirements. MONARC can be installed
on a Raspberry Pi.
It is always better to forecast more memory and disk space for MONARC
(front office) since it will host the data of the analysis.</p>
</div>
</div>
<div class="sect2">
<h3 id="network"><a class="anchor" href="#network"></a><a class="link" href="#network">2.3. Network</a></h3>
<div class="paragraph">
<p>The deployment on the different servers requires an Internet connection since
the updates are retrieved from our GitHub repositories. If this is hardly
possible in your environment due to an internal policy, you need to configure a
proxy in order to access to Internet. This is an important requirement since all
MONARC updates, including security updates, are provided from the Git
repositories.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/monarc-project/ansible-ubuntu">ansible playbook</a>
also needs an Internet connection in order to dynamically deploy new clients.</p>
</div>
<div class="paragraph">
<p>The servers (or the proxy) should be able to contact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>github.com</p>
</li>
<li>
<p>api.github.com</p>
</li>
<li>
<p>pypi.python.org</p>
</li>
<li>
<p>registry.npmjs.org</p>
</li>
<li>
<p>deb.nodesource.com</p>
</li>
<li>
<p>getcomposer.org</p>
</li>
<li>
<p>.packagist.org</p>
</li>
<li>
<p>packagist.phpcomposer.com</p>
</li>
<li>
<p>letsencrypt.org</p>
</li>
<li>
<p>APT repositories</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To make the different servers use the proxy, specify the address of your proxy
in the file <code>/home/ansible/.bash_profile</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export http_proxy=http://proxy.your.domain.com:4128
export https_proxy=http://proxy.your.domain.com:4128</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tls-certificate"><a class="anchor" href="#tls-certificate"></a><a class="link" href="#tls-certificate">2.4. TLS certificate</a></h3>
<div class="paragraph">
<p>Is is strongly advised to use a TLS certificate.</p>
</div>
<div class="paragraph">
<p>In the case you are using MONARC with a back office you can set
the certificate on the reverse proxy. The ansible playbook is
compatible Let&#8217;s Encrypt auto-renew certificates.
You will find more information
<a href="https://github.com/monarc-project/ansible-ubuntu">in the ansible playbook</a>.</p>
</div>
<div class="paragraph">
<p>If you are not using a back office you can simply configure
the certificate on the front office server.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a><a class="link" href="#architecture">3. Architecture</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="modules-of-the-project"><a class="anchor" href="#modules-of-the-project"></a><a class="link" href="#modules-of-the-project">3.1. Modules of the project</a></h3>
<div class="paragraph">
<p>The source code of MONARC is divided in several modules with dedicated Git
repositories.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Summary of the different modules of the project</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"></th>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong><a href="https://github.com/monarc-project/MonarcAppFO">MONARC</a></strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="paragraph">
<p><strong><a href="https://github.com/monarc-project/MonarcAppBO">Back Office</a></strong></p>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Modules</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>MonarcCore (<a href="https://github.com/monarc-project/zm-core">zm-core</a> in <code>vendor/monarc/core</code>)</p>
</li>
<li>
<p>MonarcFO (<a href="https://github.com/monarc-project/zm-client">zm-client</a> in <code>vendor/monarc/frontoffice</code>)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>MonarcCore (<a href="https://github.com/monarc-project/zm-core">zm-core</a> in <code>vendor/monarc/core</code>)</p>
</li>
<li>
<p>MonarcBO (<a href="https://github.com/monarc-project/zm-backoffice">zm-backoffice</a> in <code>vendor/monarc/backoffice</code>)</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Interfaces (in node_modules/)</p></th>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><a href="https://github.com/monarc-project/ng-anr">ng_anr</a></p>
</li>
<li>
<p><a href="https://github.com/monarc-project/ng-client">ng_client</a></p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><a href="https://github.com/monarc-project/ng-anr">ng_anr</a></p>
</li>
<li>
<p><a href="https://github.com/monarc-project/ng-backoffice">ng_backoffice</a></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="global-architecture"><a class="anchor" href="#global-architecture"></a><a class="link" href="#global-architecture">3.2. Global architecture</a></h3>
<div class="paragraph">
<p>Basically MONARC is composed of two main parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a back office: for the management of the security models, FO servers and
clients of MONARC installations;</p>
</li>
<li>
<p>a front office: for the management of the risks analysis. A front office
instance can be used without the back office.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want run your own risk analysis you only need the front office.
More information about the installation in
<a href="#monarc">this section</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The whole architecture includes an additional reverse proxy (<strong>RPX</strong>) and a
configuration server (<strong>CFG</strong>). It is possible to connect many front offices
(<strong>FO</strong>) to one back office (<strong>BO</strong>).
The deployment is managed with <a href="https://www.ansible.com">ansible</a>.
More information in the repository of the
<a href="https://github.com/monarc-project/ansible-ubuntu">ansible playbook</a>.</p>
</div>
<div id="monarc-architecture-schema" class="imageblock text-center">
<div class="content">
<img src="images/monarc-architecture.png" alt="MONARC Architecture">
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/NC3-LU/MOSP">MOSP</a> is a platform to create, edit
and share JSON objects.
The goal is to gather security related JSON objects, in the first place aimed
to be used with <a href="https://github.com/monarc-project/MonarcAppFO">MONARC</a>.
You can use any available schemas in order to create new JSON objects.
You can have a look at <a href="https://objects.monarc.lu">official instance</a> operated
by <a href="https://github.com/NC3-LU">NC3</a>. MONARC instances can directly query
MOSP in order to update their knowledge base. You can have a look at the
<a href="https://www.monarc.lu/documentation/MOSP-documentation/">documentation of MOSP</a>.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/monarc-project/stats-service">Stats Service</a> is an API
for the collection and processing of stats data from different MONARC instances.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Example of IPs and FQDNs:</div>
<div class="ulist">
<ul>
<li>
<p>172.18.14.73 - monarc-rpx.private.your.domain.com - my.monarc.lu</p>
</li>
<li>
<p>172.18.13.71 - monarc-conf.private.your.domain.com</p>
</li>
<li>
<p>172.18.13.72 - monarc-master.private.your.domain.com</p>
</li>
<li>
<p>172.18.13.73 - monarc-fo01.private.your.domain.com</p>
</li>
<li>
<p>172.18.13.74 - monarc-fo02.private.your.domain.com</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this example, the <strong>FO</strong> server <em>monarc-fo01</em> hosts two distinct databases
for two clients. An Apache Virtual Host is also configured for each clients. A
user who wants to do a security analysis with MONARC will access to his MONARC
account via the address <a href="https://my.monarc.lu/formation/" class="bare">https://my.monarc.lu/formation/</a></p>
</div>
<div class="paragraph">
<p>Note that the <em>common</em> database of the <strong>BO</strong> is listening on <code>0.0.0.0:3306</code>.</p>
</div>
<div id="TLS-certificate" class="paragraph">
<p>It is strongly recommended to use a TLS certificate on the reverse proxy in
order to provide a HTTPS connection between Internet and the reverse proxy. In
our example, a TLS certificate for my.monarc.lu is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="network-requirements"><a class="anchor" href="#network-requirements"></a><a class="link" href="#network-requirements">3.3. Network requirements</a></h3>
<div class="paragraph">
<p>The configuration server (<strong>CFG</strong>) manages the configurations of the back
office, reverse proxy and different front office(s) via SSH.</p>
</div>
<div class="paragraph">
<p>The reverse proxy (<strong>RPX</strong>) should of course be available from Internet. The
<strong>DNS</strong> is important for the reverse proxy in order to resolve the FQDNs of the
servers inside the network.</p>
</div>
<div class="paragraph">
<p>Through the reverse proxy you should be able to contact the <strong>BO</strong> and the
<strong>FO</strong>s from Internet. No need to able able to contact the configuration server
from the outside.</p>
</div>
<div class="paragraph">
<p>The database <em>common</em> of the BO should also be available to the FO servers.</p>
</div>
<div class="paragraph">
<p><a href="http://www.postfix.org">Postfix</a> should be installed on the BO and on the
FO. Indeed, SMTP is used for the account creation and the password recovery.
The easiest configuration is to set up Postfix for relaying emails through your
internal mail server (<strong>SMTP</strong>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation-deployment"><a class="anchor" href="#installation-deployment"></a><a class="link" href="#installation-deployment">4. Installation / Deployment</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="monarc-front-office-application"><a class="anchor" href="#monarc-front-office-application"></a><a class="link" href="#monarc-front-office-application">4.1. MONARC Front Office application</a></h3>
<div class="paragraph">
<p>There are 2 ways of installing or deployment of the MONARC Front Office application.</p>
</div>
<div class="sect3">
<h4 id="prepared-virtual-machine"><a class="anchor" href="#prepared-virtual-machine"></a><a class="link" href="#prepared-virtual-machine">4.1.1. Prepared virtual machine</a></h4>
<div class="paragraph">
<p>Virtual machine can be used in case if you would like to have a locally installed instance of the MONARC Front Office
on you PC or laptop. It is possible to use the VM installation on server, but not recommended.</p>
</div>
<div class="paragraph">
<p>Here are the steps to be performed in order to launch the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install Virtual Box application. Can be downloaded <a href="https://www.virtualbox.org/wiki/Downloads">here</a>.</p>
</li>
<li>
<p>Download the <a href="https://vm.monarc.lu/latest/">image</a> from the last release of MONARC (file with the <code>*.ova</code> extension).</p>
</li>
<li>
<p>Import the image into your VirtualBox application: Menu <code>File</code> &#8594; <code>Import Appliance</code>, select the *.ova image and follow the steps.</p>
</li>
<li>
<p>Configure the imported image: <code>Setting</code> &#8594; <code>Network</code> &#8594; select <code>Bridged Adapter</code> and click OK.</p>
</li>
<li>
<p>Start the VM:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/monarc_vm_ip_address.png" alt="MONARC Architecture"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the displayed IP in your browser to launch the application (here <a href="http://192.168.1.54" class="bare">http://192.168.1.54</a>). Recommended to use Mozilla Firefox or Google Chrome.</p>
</li>
<li>
<p>Login to your application. the credentials are provided on the GitHub <a href="https://vm.monarc.lu/latest/">release page</a>,
section <code>MONARC application</code> and usually login: <code>admin@admin.localhost</code>, password: <code>admin</code>.</p>
</li>
<li>
<p>Profit! Create and perform your risk analyzes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="manual-deployment"><a class="anchor" href="#manual-deployment"></a><a class="link" href="#manual-deployment">4.1.2. Manual deployment</a></h4>
<div class="paragraph">
<p>Follow the instructions
<a href="https://github.com/monarc-project/MonarcAppFO/tree/master/INSTALL">here</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monarc-back-office-application"><a class="anchor" href="#monarc-back-office-application"></a><a class="link" href="#monarc-back-office-application">4.2. MONARC Back Office application.</a></h3>
<div class="paragraph">
<p>In case if you would like to install the MONARC Back Office application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is useful if you plan to manage several clients.
If you want run your own risk analysis you only need the front office.
More information about the installation in
<a href="#monarc">this section</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The whole architecture can be deployed with
<a href="https://www.ansible.com">ansible</a>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/monarc-architecture.png" alt="MONARC Architecture">
</div>
</div>
<div class="sect3">
<h4 id="requirements-2"><a class="anchor" href="#requirements-2"></a><a class="link" href="#requirements-2">4.2.1. Requirements</a></h4>
<div class="ulist">
<ul>
<li>
<p>Git and Python on all servers;</p>
</li>
<li>
<p>ansible must be installed on the configuration server;</p>
</li>
<li>
<p>Postfix on the BO and all FO servers (for the password recovery feature
of MONARC).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="usage"><a class="anchor" href="#usage"></a><a class="link" href="#usage">4.2.2. Usage</a></h4>
<div class="paragraph">
<p>Install ansible on the configuration server and get the playbook for MONARC:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sudo apt-get install python-pip
sudo -H pip install ansible dnspython
git clone https://github.com/monarc-project/ansible-ubuntu.git
cd ansible-ubuntu/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">4.2.3. Configuration</a></h4>
<div class="ulist">
<ul>
<li>
<p>create a user named <strong>ansible</strong> on each server;</p>
</li>
<li>
<p>generate a SSH key for the user <strong>ansible</strong> on the configuration server:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">ssh-keygen -t rsa -C &quot;your_email@example.com&quot;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>copy the public key on the other servers:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">ssh-copy-id ansible@BO
ssh-copy-id ansible@RPX
ssh-copy-id ansible@FO</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>add the user <strong>ansible</strong> in the <strong>sudo</strong> group:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">sudo usermod -aG sudo ansible</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>add the user <strong>www-data</strong> in the <strong>ansible</strong> group:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">sudo usermod -aG ansible www-data</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>give the permission to ansible to use sudo without password:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">echo 'ansible ALL=(ALL:ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>create a file <em>inventory/hosts</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">[dev]
FO

[dev:vars]
master= &quot;BO&quot;
publicHost= &quot;monarc.example.com&quot;

[master]
BO monarc_sql_password=&quot;password&quot;

[rpx]
RPX.localhost

[monarc:children]
rpx
master
dev

[monarc:vars]
env_prefix=&quot;&quot;
clientDomain=&quot;monarc.example.com&quot;
emailFrom=&quot;info@example.com&quot;
github_auth_token=&quot;&lt;your-github-auth-token&gt;&quot;
protocol=&quot;https&quot;
certificate=&quot;sslcert.crt&quot;
certificatekey=&quot;sslcert.key&quot;
certificatechain=&quot;sslcert.crt&quot;
bourlalias=&quot;monarcbo&quot;
localDNS=&quot;example.net&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable <strong>monarc_sql_password</strong> is the password for the SQL database on
the BO.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>finally, launch ansible:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asciidoc">cd playbook/
ansible-playbook -i ../inventory/ monarc.yaml --user ansible</code></pre>
</div>
</div>
<div class="paragraph">
<p>ansible will install and configure the back office, the front office and the
reverse proxy. Consequently the configuration server should be able to contact
these servers through SSH.</p>
</div>
<div class="paragraph">
<p>You will find more information
<a href="https://github.com/monarc-project/ansible-ubuntu">in the ansible playbook</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="launch-ansible-periodically-with-cron"><a class="anchor" href="#launch-ansible-periodically-with-cron"></a><a class="link" href="#launch-ansible-periodically-with-cron">4.2.4. Launch ansible periodically with cron</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ crontab -l
# m h  dom mon dow   command
*/30 * * * * /home/ansible/ansible-ubuntu/playbook/update.sh /home/ansible/ansible-ubuntu BO</code></pre>
</div>
</div>
<div class="paragraph">
<p>This cron task should be launched on the configuration server by the <strong>ansible</strong>
user.</p>
</div>
<div class="paragraph">
<p>If a new client is created via the web interface of the back office, this task
will instantiate a new MONARC instance (new database, new Apache VirtualHost
and eventually a new server) for the newly created client.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-the-ansible-playbook"><a class="anchor" href="#update-the-ansible-playbook"></a><a class="link" href="#update-the-ansible-playbook">4.2.5. Update the ansible playbook</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd /home/ansible/ansible-ubuntu/
$ git pull origin master</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="updates"><a class="anchor" href="#updates"></a><a class="link" href="#updates">5. Updates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before updating MONARC it is advised to configure database backup.
For that you need to create a file <code>data/backup/credentialsmysql.cnf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ini">[client]
host     = localhost
user     = sql-monarc-user
password = your-password
socket   = /var/run/mysqld/mysqld.sock
[mysql_upgrade]
host     = localhost
user     = sql-monarc-user
password = your-password
socket   = /var/run/mysqld/mysqld.sock
basedir  = /usr</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this file is not present, a warning message will be displayed during the
update.</p>
</div>
<div class="sect2">
<h3 id="system-update"><a class="anchor" href="#system-update"></a><a class="link" href="#system-update">5.1. System update</a></h3>
<div class="paragraph">
<p>Keep the software of your distribution up-to-date (Apache, PHP, MariaDB,
Postfix, etc.). At least the security updates from the GNU/Linux distribution.</p>
</div>
</div>
<div class="sect2">
<h3 id="monarc-update"><a class="anchor" href="#monarc-update"></a><a class="link" href="#monarc-update">5.2. MONARC update</a></h3>
<div class="sect3">
<h4 id="update-a-single-monarc-instance"><a class="anchor" href="#update-a-single-monarc-instance"></a><a class="link" href="#update-a-single-monarc-instance">5.2.1. Update a single MONARC instance</a></h4>
<div class="paragraph">
<p>If you have already installed MONARC and want to update to a later version, you
can use the provided script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./scripts/update-all.sh -c
$ rm -Rf ./data/cache
$ sudo systemctl restart apache2.service</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updates from the last stable release of MONARC will be retrieved.</p>
</div>
<div class="paragraph">
<p>For more details the script will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>backup your databases in case the update fails (if enabled, as explained
previously);</p>
</li>
<li>
<p>check the presence of composer and if needed install it;</p>
</li>
<li>
<p>retrieve the new code from the last stable release (master branch):</p>
<div class="ulist">
<ul>
<li>
<p>pull updates for module/[MonarcCore, MonarcBO/MonarcFO] via composer;</p>
</li>
<li>
<p>pull updates for node_modules/[ng_anr, ng_backoffice/ng_client].</p>
</li>
</ul>
</div>
</li>
<li>
<p>run the appropriate database upgrade scripts;</p>
</li>
<li>
<p>update the translations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please be aware that by default the update script will run database migrations
This behavior can be changed by passing the <code>-b</code> option to the update script.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-monarc-when-connected-to-a-back-office"><a class="anchor" href="#update-monarc-when-connected-to-a-back-office"></a><a class="link" href="#update-monarc-when-connected-to-a-back-office">5.2.2. Update MONARC when connected to a back office</a></h4>
<div class="paragraph">
<p>When MONARC is connected to a back office and has been deployed with the
<a href="https://github.com/monarc-project/ansible-ubuntu">ansible playbook</a>,
three steps are required for a full proper update.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update of the back office</p>
</li>
<li>
<p>Update of MONARC</p>
</li>
<li>
<p>Update of the configuration server (ansible playbook)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Always use the <strong>ansible</strong> user.</p>
</div>
<div class="sect4">
<h5 id="back-office"><a class="anchor" href="#back-office"></a><a class="link" href="#back-office">Back office</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ su ansible
$ cd /var/lib/monarc/bo/MonarcAppBO/
$ ./scripts/update-all.sh
$ sudo systemctl restart apache2.service</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="front-office"><a class="anchor" href="#front-office"></a><a class="link" href="#front-office">Front office</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ su ansible
$ cd /var/lib/monarc/fo
$ ./scripts/update-all.sh -b
$ sudo systemctl restart apache2.service</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuration-server"><a class="anchor" href="#configuration-server"></a><a class="link" href="#configuration-server">Configuration server</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ su ansible
$ cd /home/ansible/ansible-ubuntu/
$ git pull origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have any problem you can check the section dedicated to the
<a href="https://www.monarc.lu/documentation/common-issues">common issues</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stats-service"><a class="anchor" href="#stats-service"></a><a class="link" href="#stats-service">6. Stats Service</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Stats Service</strong> is a service that helps Monarc applications aggregate statistics from its different instances
and serves Monarc applications with the data, plain or transformed to different formats for the charts' views.
The stats, displayed in the Monarc Front Office local user interface on Global Dashboard tab, is called <strong>Local Instance Statistics</strong>.</p>
</div>
<div class="paragraph">
<p>Different installations of Stats Service can also share the statistics to the <strong>Global Statistics</strong> (<a href="https://dashboard.monarc.lu"><strong>Monarc dashboard</strong></a>)
that can be used for the community and future weather forecast.
The shared data do not have an identification of Monarc Front Office instance.</p>
</div>
<div class="paragraph">
<p>An architecture of Monarc Front Offices and Back Offices instance(s) communicated with Stats Service(s) and Global Statistics can be found <a href="https://www.monarc.lu/documentation/stats-service/master/architecture.html"><strong>here</strong></a>.</p>
</div>
<div class="sect2">
<h3 id="installation-of-the-stats-service"><a class="anchor" href="#installation-of-the-stats-service"></a><a class="link" href="#installation-of-the-stats-service">6.1. Installation of the Stats Service</a></h3>
<div class="paragraph">
<p>Depends on the Monarc project infrastructure the Stats Service can be installed in different places.</p>
</div>
<div class="paragraph">
<p>In case if the Monarc installation has a Back Office instance, which means that you most probably have multiple Front Office instances,
it is recommended to install Stats Service on the same server where the Back Office app is installed.
The reason is that all the Front Office instances as well as Back Office need to be able to communicate with Stats Service.
But having a separate (virtual) server for StatsService is also a good solution.</p>
</div>
<div class="paragraph">
<p>The installation instructions as well as system requirements can be found <a href="https://www.monarc.lu/documentation/stats-service/master/installation.html">here</a>.
Stats Service project is available on <a href="https://github.com/monarc-project/stats-service">GitHub</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="accounts-on-the-stats-service"><a class="anchor" href="#accounts-on-the-stats-service"></a><a class="link" href="#accounts-on-the-stats-service">6.2. Accounts on the Stats Service</a></h3>
<div class="paragraph">
<p>In order to send and get the statistics to/from the Stats Service you need to create accounts for each of your Front Office instances.</p>
</div>
<div class="paragraph">
<p><code>Note</code>. This operation is done by <a href="https://github.com/monarc-project/ansible-ubuntu/blob/master/playbook/monarcbo/tasks/main.yaml#L199">ansible</a>,
but in case of installations of only Front Office instance(s) or if ansible is not used, the process can be done manually.</p>
</div>
<div class="paragraph">
<p>There is a console command to create an account, needs to be executed from your Stats Service home folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  contrib/create_client.sh {YourClientName}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where {YourClientName} is a name of your Front Office instance.</p>
</div>
<div class="paragraph">
<p>The output should contain the following lines (for example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">  ~/stats-service$ contrib/create_client.sh Cases
  UUID: c08e380f-7ec0-43ff-bca2-4505856739e0
  Name: Cases
  Role: 1
  Token: ECsBPF5Lh3NreoSUTsxwDESri0UuIkpmHcHk6Zr8lXXQX_TVNAEnGv_6hGvmyBVw9XONpUCw2KIGoufRJ4jCFB
  Created at: 2021-01-01 12:51:18.776037</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-of-front-office-instance"><a class="anchor" href="#configuration-of-front-office-instance"></a><a class="link" href="#configuration-of-front-office-instance">6.3. Configuration of Front Office instance</a></h3>
<div class="paragraph">
<p><code>Note</code>. Ansible does the job for us, the configuration is needed when it is not used.</p>
</div>
<div class="paragraph">
<p>When the client is created on Stats Service side, the generated token need to be set in the Front Office(es) configuration
<a href="https://github.com/monarc-project/MonarcAppFO/blob/master/config/autoload/local.php.dist#L81">file</a>(s).</p>
</div>
<div class="paragraph">
<p>The other option to be setup is the Stats Service <a href="https://github.com/monarc-project/MonarcAppFO/blob/master/config/autoload/local.php.dist#L80">baseUrl</a>.
The value depends on its installation and can be, for instance, an ip address of the Back Office server. The default port is 5005.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-of-the-cronjob"><a class="anchor" href="#configuration-of-the-cronjob"></a><a class="link" href="#configuration-of-the-cronjob">6.4. Configuration of the cronjob</a></h3>
<div class="paragraph">
<p>The user, under which the crontab is executed, should have read and execute permissions to the following files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/var/lib/monarc/fo/scripts/collect-stats-for-all-clients.sh</code></p>
</li>
<li>
<p><code>/var/lib/monarc/fo/vendor/monarc/frontoffice/bin/console</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Note</code>. The permissions are set by ansible during the deployment process, but in case if ansible is not used, then permissions can be set like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  chmod 755 /var/lib/monarc/fo/scripts/collect-stats-for-all-clients.sh`
  chmod 755 /var/lib/monarc/fo/vendor/monarc/frontoffice/bin/console`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cronjob needs to be scheduled on daily base to have a precise stats data evolution and changes.</p>
</div>
<div class="paragraph">
<p>It is possible to create a cronjob file (name can be e.g. stats-collector) in the directory <code>/var/etc/cron.d/</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  05 00 * * * www-data /var/lib/monarc/fo/bin/console monarc:collect-stats &gt;&gt; /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of multiple Front Office instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  05 00 * * * www-data /var/lib/monarc/fo/scripts/collect-stats-for-all-clients.sh &gt;&gt; /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or modify the crontab for a particular user (e.g. www-data): <code>sudo -u www-data crontab -e</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  05 00 * * * /var/lib/monarc/fo/bin/console monarc:collect-stats &gt;&gt; /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of multiple Front Office instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  05 00 * * * /var/lib/monarc/fo/scripts/collect-stats-for-all-clients.sh &gt;&gt; /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to log the stats collection output, needs to be created the file in log directory with the write permissions for the user,
which executes the cronjob:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  sudo mkdir -p /var/log/crontab
  sudo touch /var/log/crontab/collect-stats.log
  sudo chmod 0766 /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recommendations"><a class="anchor" href="#recommendations"></a><a class="link" href="#recommendations">6.5. Recommendations</a></h3>
<div class="paragraph">
<p>It is recommended to test the integration between Front Office and Stat Service by executing the same command scheduled in the crontab:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  /var/lib/monarc/fo/bin/console monarc:collect-stats</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case of multiple Front Office instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">  /var/lib/monarc/fo/scripts/collect-stats-for-all-clients.sh &gt;&gt; /var/log/crontab/collect-stats.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an output in the log file <code>collect-stats.log</code> should be list of UUIDs of analyses, the statistics collected for and sent to Stats Service.</p>
</div>
</div>
<div class="sect2">
<h3 id="challenges"><a class="anchor" href="#challenges"></a><a class="link" href="#challenges">6.6. Challenges</a></h3>
<div class="paragraph">
<p>In case if your Front Office and Stats Service installed on different physical or virtual servers and there is a proxy configuration,
you need to be sure that the internal connection goes directly.
The user, which executes the cronjob, can have no-proxy environment setting, as far as it&#8217;s not needed for internal communication.</p>
</div>
<div class="paragraph">
<p>The servers connectivity can be traced with the network monitoring.</p>
</div>
</div>
<div class="sect2">
<h3 id="global-dashboard-on-stats-service"><a class="anchor" href="#global-dashboard-on-stats-service"></a><a class="link" href="#global-dashboard-on-stats-service">6.7. Global Dashboard on Stats Service</a></h3>
<div class="paragraph">
<p>In order to make the web interface of Global Dashboard on Stats Service accessible, should be configured a virtual host and proxy settings to forward the particular requests to the service.
It can be configured the same way as your Back Office instance access.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2023-01-31<br>
Last updated 2023-01-31 11:31:14 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>